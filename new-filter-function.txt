async function filterResults(userIntent, results) {
  if (!results || results.length === 0) return [];
  
  logger.info(`ðŸš€ Generating unique descriptions for top 3 results (instant!)`);
  
  // AWESOME rule-based descriptions - each restaurant gets unique content based on actual data!
  return results.slice(0, 3).map((place, idx) => {
    const rating = parseFloat(place.rating) || 0;
    const reviews = place.user_ratings_total || 0;
    const types = place.types || [];
    const cuisine = userIntent.search_term || "food";
    
    // REASON - Based on rating tiers with SPECIFIC numbers
    let reason;
    if (rating >= 4.7 && reviews > 500) {
      const templates = [
        `Exceptional ${cuisine} with a stellar ${rating}â­ rating from ${reviews}+ glowing reviews`,
        `Top-tier ${cuisine} spot - ${reviews}+ customers rave about it (${rating}â­)`,
        `Outstanding quality backed by ${reviews}+ reviews averaging ${rating} stars`
      ];
      reason = templates[idx % templates.length];
    } else if (rating >= 4.5 && reviews > 200) {
      const templates = [
        `Highly rated ${cuisine} favorite - ${reviews}+ reviews, ${rating}â­ average`,
        `Popular choice for ${cuisine} with ${rating}-star quality (${reviews}+ satisfied diners)`,
        `Consistently excellent ${cuisine}, proven by ${reviews}+ customers rating it ${rating}â­`
      ];
      reason = templates[idx % templates.length];
    } else if (rating >= 4.0) {
      const templates = [
        `Solid ${cuisine} option with ${rating}â­ from ${reviews} local diners`,
        `Quality ${cuisine} spot maintaining ${rating}-star standards`,
        `Reliable ${cuisine} choice - ${reviews} reviews averaging ${rating}â­`
      ];
      reason = templates[idx % templates.length];
    } else {
      reason = `${cuisine} spot with ${rating}â­ rating based on ${reviews} reviews`;
    }
    
    // UNIQUE SELLING POINT - Based on restaurant characteristics  
    let usp;
    if (types.includes('bar') || types.includes('night_club')) {
      const templates = [
        'Full bar with craft cocktails - dining meets nightlife',
        'Vibrant bar scene perfect for drinks and socializing',
        'Great beverage program complements the food menu'
      ];
      usp = templates[idx % templates.length];
    } else if (types.includes('cafe') || types.includes('bakery')) {
      const templates = [
        'Cozy cafÃ© atmosphere with artisanal coffee and fresh pastries',
        'Perfect morning spot for specialty coffee and baked goods',
        'Relaxed cafÃ© vibe ideal for working or unwinding'
      ];
      usp = templates[idx % templates.length];
    } else if (types.includes('meal_delivery') || types.includes('meal_takeaway')) {
      const templates = [
        'Convenient takeout and delivery without sacrificing quality',
        'Popular for both dine-in and grab-and-go',
        'Fast service perfect for busy schedules'
      ];
      usp = templates[idx % templates.length];
    } else if (types.includes('fine_dining')) {
      const templates = [
        'Upscale dining experience with meticulous attention to detail',
        'Fine dining destination for special occasions',
        'Premium ingredients and refined culinary techniques'
      ];
      usp = templates[idx % templates.length];
    } else if (rating >= 4.7) {
      const templates = [
        'Award-worthy quality that earns its premium ratings',
        'Local legend known for consistently outstanding dishes',
        'Top-tier establishment setting the standard for excellence'
      ];
      usp = templates[idx % templates.length];
    } else if (reviews > 500) {
      const templates = [
        'Time-tested favorite with hundreds of loyal regulars',
        'Established reputation built on consistent quality',
        'Community staple that keeps people coming back'
      ];
      usp = templates[idx % templates.length];
    } else {
      const templates = [
        'Authentic flavors served with genuine hospitality',
        'Quality ingredients prepared with care',
        'Hidden gem worth discovering'
      ];
      usp = templates[idx % templates.length];
    }
    
    // OCCASION FIT - Based on user mood and restaurant type
    let occasion;
    const mood = userIntent.mood || 'casual';
    if (mood === 'romantic' || types.includes('fine_dining')) {
      const templates = [
        'Intimate ambiance perfect for romantic dates and proposals',
        'Elegant setting ideal for celebrating special moments together',
        'Sophisticated atmosphere that sets the mood for romance'
      ];
      occasion = templates[idx % templates.length];
    } else if (mood === 'celebration') {
      const templates = [
        'Festive atmosphere great for birthdays and milestones',
        'Upbeat vibe perfect for group celebrations',
        'Memorable setting for life\'s special occasions'
      ];
      occasion = templates[idx % templates.length];
    } else if (types.includes('bar') || types.includes('night_club')) {
      const templates = [
        'Lively social scene perfect for friends and after-work drinks',
        'Energetic vibe ideal for group outings',
        'Fun atmosphere great for mixing food and nightlife'
      ];
      occasion = templates[idx % templates.length];
    } else if (types.includes('cafe') || types.includes('bakery')) {
      const templates = [
        'Chill space perfect for solo work sessions or casual meetups',
        'Comfortable setting for catching up with friends over coffee',
        'Relaxed environment suitable for any time of day'
      ];
      occasion = templates[idx % templates.length];
    } else {
      const templates = [
        'Versatile setting that works for everything from solo meals to group dinners',
        'Welcoming atmosphere whether you\'re dining alone or with company',
        'Comfortable space adaptable to any dining occasion'
      ];
      occasion = templates[idx % templates.length];
    }
    
    // DIETARY MATCH - Based on restaurant type
    let dietary;
    if (types.includes('vegetarian_restaurant')) {
      dietary = 'Dedicated vegetarian menu with creative plant-based dishes';
    } else if (types.includes('vegan_restaurant')) {
      dietary = '100% vegan menu with diverse options';
    } else if (types.includes('halal_restaurant')) {
      dietary = 'Halal-certified with proper preparation standards';
    } else if (types.includes('gluten_free_restaurant')) {
      dietary = 'Gluten-free focused with dedicated kitchen practices';
    } else if (userIntent.dietary_restrictions?.length > 0) {
      dietary = `Ask staff about ${userIntent.dietary_restrictions.join(', ')} accommodations`;
    } else {
      dietary = 'Standard menu - inquire about dietary modifications';
    }
    
    return {
      ...safeRestaurant(place),
      reason,
      unique_selling_point: usp,
      occasion_fit: occasion,
      dietary_match: dietary,
      images: place.images || []
    };
  });
}

